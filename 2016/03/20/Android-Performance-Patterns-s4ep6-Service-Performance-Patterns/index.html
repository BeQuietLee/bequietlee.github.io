<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android Performance Patterns - s4ep6 Service Performance Patterns | One Step, One Punch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Services are an integral component of almost every android application. But the functionality they provide comes with a drain on battery and system resources. And if you’re not paying attention, serv">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Performance Patterns - s4ep6 Service Performance Patterns">
<meta property="og:url" content="http://lilei.work/2016/03/20/Android-Performance-Patterns-s4ep6-Service-Performance-Patterns/index.html">
<meta property="og:site_name" content="One Step, One Punch">
<meta property="og:description" content="Services are an integral component of almost every android application. But the functionality they provide comes with a drain on battery and system resources. And if you’re not paying attention, serv">
<meta property="og:image" content="http://lilei.work/img/160320_app_s4ep6/cost.png">
<meta property="og:image" content="http://lilei.work/img/160320_app_s4ep6/started_services.png">
<meta property="og:image" content="http://lilei.work/img/160320_app_s4ep6/bound_services.png">
<meta property="og:image" content="http://lilei.work/img/160320_app_s4ep6/mixed_services.png">
<meta property="og:updated_time" content="2016-06-29T06:22:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Performance Patterns - s4ep6 Service Performance Patterns">
<meta name="twitter:description" content="Services are an integral component of almost every android application. But the functionality they provide comes with a drain on battery and system resources. And if you’re not paying attention, serv">
<meta name="twitter:image" content="http://lilei.work/img/160320_app_s4ep6/cost.png">
  
    <link rel="alternative" href="/atom.xml" title="One Step, One Punch" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">One Step, One Punch</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">bequietlee#gmail.com</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lilei.work"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Android-Performance-Patterns-s4ep6-Service-Performance-Patterns" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/20/Android-Performance-Patterns-s4ep6-Service-Performance-Patterns/" class="article-date">
  <time datetime="2016-03-20T11:03:45.000Z" itemprop="datePublished">2016-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android Performance Patterns - s4ep6 Service Performance Patterns
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Services are an integral component of almost every android application. But the functionality they provide comes with a drain on battery and system resources. And if you’re not paying attention, services can easily stick around longer than they should which wastes system resources, and can often cause performance problems for your rendering thread. But Colt McAnlis has the answer : using services in the most efficient way possible means killing them off the right way, and sometimes, not even using them.<br><a href="https://www.youtube.com/watch?v=NJsq0TU0qeg&amp;index=16&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE" target="_blank" rel="external">Video Link</a></p>
</blockquote>
<iframe width="560" height="315" src="https://www.youtube.com/embed/NJsq0TU0qeg?list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE" frameborder="0" allowfullscreen></iframe>

<hr>
<a id="more"></a>
<h4 id="On-System-Level-Services-Ain’t-Free"><a href="#On-System-Level-Services-Ain’t-Free" class="headerlink" title="On System Level, Services Ain’t Free"></a>On System Level, Services Ain’t Free</h4><p>创建、销毁 Service 需要时间与内存</p>
<p><img src="/img/160320_app_s4ep6/cost.png" alt=""></p>
<hr>
<h4 id="Service-May-Cost-Frame-Lost"><a href="#Service-May-Cost-Frame-Lost" class="headerlink" title="Service May Cost Frame Lost"></a>Service May Cost Frame Lost</h4><ol>
<li>作为 Local Service 启动，对应的 Service 运行在主进程的主线程上</li>
<li>作为 Remote Service 启动，对应的 Service 则是运行在独立进程的主线程上</li>
</ol>
<p>对于<code>1</code>中的情况，如果 Service 中进行了耗时操作（超过了16ms），则在屏幕绘制时可能引起丢帧。</p>
<hr>
<h4 id="Don’t-Use-Services"><a href="#Don’t-Use-Services" class="headerlink" title="Don’t Use Services"></a>Don’t Use Services</h4><p>if you don’t have to…</p>
<p>参见下一节罗列的 Solutions</p>
<hr>
<h4 id="Async-Event-Functions"><a href="#Async-Event-Functions" class="headerlink" title="Async Event Functions"></a>Async Event Functions</h4><ul>
<li>GCM</li>
<li>BroadcastReceiver</li>
<li>LocalBroadcastReceiver</li>
<li>HandlerThreads</li>
<li>AsyncTaskLoaders</li>
<li>IntentService</li>
</ul>
<hr>
<h4 id="Do-not-Let-Services-Live-Longer-Than-They-Needed"><a href="#Do-not-Let-Services-Live-Longer-Than-They-Needed" class="headerlink" title="Do not Let Services Live Longer Than They Needed"></a>Do not Let Services Live Longer Than They Needed</h4><p>Service 有两种不同的启动方法，对应的种植方法也为两种</p>
<ul>
<li>Started Services：在 Service 中调用<code>stopSelf()</code>，或者在外面调用<code>stopService()</code>来终止</li>
</ul>
<p><img src="/img/160320_app_s4ep6/started_services.png" alt=""></p>
<ul>
<li>Bound Services：通过<code>unBindService()</code>来终止</li>
</ul>
<p><img src="/img/160320_app_s4ep6/bound_services.png" alt=""></p>
<ul>
<li>Mixed：如果是先通过<code>startService()</code>启动，再用<code>bindService()</code>绑定的 Service，那么在<code>unBind()</code>后，还要显示通过<code>stopService()</code>来终止</li>
</ul>
<p><img src="/img/160320_app_s4ep6/mixed_services.png" alt=""></p>
<hr>
<h4 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h4><ul>
<li>光头哥又在推销 <a href="http://developer.android.com/tools/help/systrace.html" target="_blank" rel="external">Systrace</a> 了</li>
</ul>
<hr>
<h4 id="Ending"><a href="#Ending" class="headerlink" title="===Ending==="></a><em>===Ending===</em></h4><hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lilei.work/2016/03/20/Android-Performance-Patterns-s4ep6-Service-Performance-Patterns/" data-id="cixv694de0007ptsuamowydx5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-Performance-Patterns/">Android Performance Patterns</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术流/">技术流</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/24/Nova-Automation-Develop-Plan/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          nova自动化测试后续内容安排
        
      </div>
    </a>
  
  
    <a href="/2016/03/08/Android-Performance-Patterns-s4ep5-Minimizing-Asset-Payload/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android Performance Patterns - s4ep5 Minimizing Asset Payload</div>
    </a>
  
</nav>

  
</article>


 <section id="comments">
   <!-- 多说评论框 start -->
   <div class="ds-thread" data-thread-key="post-Android-Performance-Patterns-s4ep6-Service-Performance-Patterns" data-title="Android Performance Patterns - s4ep6 Service Performance Patterns" data-url="http://lilei.work/2016/03/20/Android-Performance-Patterns-s4ep6-Service-Performance-Patterns/"></div>
   <!-- 多说评论框 end -->
   <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
   <script type="text/javascript">
   var duoshuoQuery = {short_name:'lileiwork'};
     (function() {
       var ds = document.createElement('script');
       ds.type = 'text/javascript';ds.async = true;
       ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
       ds.charset = 'UTF-8';
       (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
     })();
     </script>
   <!-- 多说公共JS代码 end -->
 </section>
 </section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Performance-Patterns/">Android Performance Patterns</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio/">Android Studio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backend/">Backend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大保健/">大保健</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作效率/">工作效率</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微信小程序/">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术流/">技术流</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/槑/">槑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码分析/">源码分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化测试/">自动化测试</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目/">项目</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
    <div class="widget-wrap">
	<h3 class="widget-title">Links</h3>
	<div class="widget">
		<ul class="entry">
		<li><a href="http://www.dcharm.com" title="dcharm">DCharm.com</a></li>
		<li><a href="http://www.lightskystreet.com" title="lightSky">lightSky's Blog</a></li>
		</ul>
	</div>
</div>
  
    <div class="widget-wrap">
	<h3 class="widget-title">Recent Comments</h3>
	<div class="widget">
		<ul class="ds-recent-comments" data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></ul>
	</div>
</div>

<!--多说js加载开始，一个页面只需要加载一次 -->
<script type="text/javascript">
if(typeof duoshuoQuery === 'undefined') {
	  var duoshuoQuery = {short_name:"lileiwork"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = 'http://static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
  }
</script>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Li Lei<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>