<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android Performance Patterns - s4ep7 Removing Unused Code | One Step, One Punch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Third party libraries can be some serious time savers for Android development. They allow us to do awesome things in our app without having to write any of the functionality ourselves. That’s a prett">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Performance Patterns - s4ep7 Removing Unused Code">
<meta property="og:url" content="http://lilei.work/2016/03/31/Android-Performance-Patterns-s4ep7-Removing-Unused-Code/index.html">
<meta property="og:site_name" content="One Step, One Punch">
<meta property="og:description" content="Third party libraries can be some serious time savers for Android development. They allow us to do awesome things in our app without having to write any of the functionality ourselves. That’s a prett">
<meta property="og:image" content="http://lilei.work/img/160331_app_s4ep7/advantage.png">
<meta property="og:image" content="http://lilei.work/img/160331_app_s4ep7/code_bloat.png">
<meta property="og:image" content="http://lilei.work/img/160331_app_s4ep7/proguard.png">
<meta property="og:updated_time" content="2016-06-29T06:22:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Performance Patterns - s4ep7 Removing Unused Code">
<meta name="twitter:description" content="Third party libraries can be some serious time savers for Android development. They allow us to do awesome things in our app without having to write any of the functionality ourselves. That’s a prett">
<meta name="twitter:image" content="http://lilei.work/img/160331_app_s4ep7/advantage.png">
  
    <link rel="alternative" href="/atom.xml" title="One Step, One Punch" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">One Step, One Punch</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">bequietlee#gmail.com</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lilei.work"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Android-Performance-Patterns-s4ep7-Removing-Unused-Code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/31/Android-Performance-Patterns-s4ep7-Removing-Unused-Code/" class="article-date">
  <time datetime="2016-03-31T01:41:01.000Z" itemprop="datePublished">2016-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android Performance Patterns - s4ep7 Removing Unused Code
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Third party libraries can be some serious time savers for Android development. They allow us to do awesome things in our app without having to write any of the functionality ourselves. That’s a pretty big convenience. What’s not convenient though is the code-bloat they can often come with.</p>
<p><a href="https://www.youtube.com/watch?v=5frxLkO4oTM&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE&amp;index=17" target="_blank" rel="external">Video Link</a></p>
</blockquote>
<iframe width="560" height="315" src="https://www.youtube.com/embed/5frxLkO4oTM?list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE" frameborder="0" allowfullscreen></iframe>

<hr>
<a id="more"></a>
<h4 id="Third-Party-Library"><a href="#Third-Party-Library" class="headerlink" title="Third Party Library"></a>Third Party Library</h4><p>在自己的app中使用第三方库有哪些优点呢？</p>
<ul>
<li>第三方库可以为我们提供便捷的功能</li>
<li>它们都经过了良好全面的测试，并且在生产环境中得到验证</li>
</ul>
<p><img src="/img/160331_app_s4ep7/advantage.png" alt=""></p>
<p>而缺点可能就不那么明显</p>
<ul>
<li>你必须引用整个第三方库，即使用到的只是其中一个简单的类——这被叫做<code>code bloat</code>（代码膨胀）</li>
<li>这会使你的apk体积增大</li>
<li>甚至可能触及65k的方法数天花板（关于65k，请查阅这一篇<a href="https://developer.android.com/tools/building/multidex.html" target="_blank" rel="external">Building Apps with Over 65K Methods</a>）</li>
</ul>
<p><img src="/img/160331_app_s4ep7/code_bloat.png" alt=""></p>
<p>对于<code>MultiDex</code>，小哥给出了非常幽默的描述</p>
<blockquote>
<p>It’s pretty much as much fun going to the dentist…</p>
</blockquote>
<hr>
<h4 id="Proguard"><a href="#Proguard" class="headerlink" title="Proguard"></a>Proguard</h4><p>作用</p>
<ul>
<li>Shrink：精简代码，去除无用的类</li>
<li>Optimize：优化逻辑</li>
<li>Obfuscate：混淆，增加逆向工程的难度</li>
</ul>
<p>一个例子是，使用Proguard后，原本8.4mb的Google IO app被缩减到了4.1mb</p>
<p><img src="/img/160331_app_s4ep7/proguard.png" alt=""></p>
<p>开启 proguard 也十分简单，只要在 gradle 文件中将 <code>minifyEnabled</code> 属性声明为 <code>true</code>，并写明 <code>proguardFiles</code> 路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	...</span><br><span class="line">	buildTypes &#123;</span><br><span class="line">		release &#123;</span><br><span class="line">			minifyEnabled <span class="literal">true</span></span><br><span class="line">			proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，proguard会导致应用到“反射”的代码无法正常工作，因为它会改变方法名&amp;类名，需要用 <code>keep</code> 在相关代码上关闭proguard</p>
<p><a href="http://developer.android.com/tools/help/proguard.html" target="_blank" rel="external">ProGuard 官方文档</a></p>
<hr>
<h3 id="Ending"><a href="#Ending" class="headerlink" title="===Ending==="></a><em>===Ending===</em></h3><hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lilei.work/2016/03/31/Android-Performance-Patterns-s4ep7-Removing-Unused-Code/" data-id="ciz3hdsbi0004x4sul4h1ljpn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-Performance-Patterns/">Android Performance Patterns</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术流/">技术流</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/31/Git-Squash-Commits/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          使用Git对最近n个commit进行合并
        
      </div>
    </a>
  
  
    <a href="/2016/03/24/Fixing-Anterior-Pelvic-Tilt/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">骨盆前倾101</div>
    </a>
  
</nav>

  
</article>


 <section id="comments">
   <!-- 多说评论框 start -->
   <div class="ds-thread" data-thread-key="post-Android-Performance-Patterns-s4ep7-Removing-Unused-Code" data-title="Android Performance Patterns - s4ep7 Removing Unused Code" data-url="http://lilei.work/2016/03/31/Android-Performance-Patterns-s4ep7-Removing-Unused-Code/"></div>
   <!-- 多说评论框 end -->
   <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
   <script type="text/javascript">
   var duoshuoQuery = {short_name:'lileiwork'};
     (function() {
       var ds = document.createElement('script');
       ds.type = 'text/javascript';ds.async = true;
       ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
       ds.charset = 'UTF-8';
       (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
     })();
     </script>
   <!-- 多说公共JS代码 end -->
 </section>
 </section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Performance-Patterns/">Android Performance Patterns</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio/">Android Studio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backend/">Backend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大保健/">大保健</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作效率/">工作效率</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微信小程序/">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术流/">技术流</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/槑/">槑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码分析/">源码分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化测试/">自动化测试</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
    <div class="widget-wrap">
	<h3 class="widget-title">Links</h3>
	<div class="widget">
		<ul class="entry">
		<li><a href="http://www.dcharm.com" title="dcharm">DCharm.com</a></li>
		<li><a href="http://www.lightskystreet.com" title="lightSky">lightSky</a></li>
		</ul>
	</div>
</div>
  
    <div class="widget-wrap">
	<h3 class="widget-title">Recent Comments</h3>
	<div class="widget">
		<ul class="ds-recent-comments" data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></ul>
	</div>
</div>

<!--多说js加载开始，一个页面只需要加载一次 -->
<script type="text/javascript">
if(typeof duoshuoQuery === 'undefined') {
	  var duoshuoQuery = {short_name:"lileiwork"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = 'http://static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
  }
</script>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Li Lei<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>