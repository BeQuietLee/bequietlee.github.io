<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android Performance Patterns - s4ep8 Removing Unused Resources | One Step, One Punch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Although YOU may be diligent in removing resources your app won’t use, it’s not safe to assume that the LIBRARIES you’re including will do the same.Thankfully some helpful Gradle tools can put your A">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Performance Patterns - s4ep8 Removing Unused Resources">
<meta property="og:url" content="http://lilei.work/2017/02/14/Android-Performance-Patterns-s4ep8-Removing-Unused-Resources/index.html">
<meta property="og:site_name" content="One Step, One Punch">
<meta property="og:description" content="Although YOU may be diligent in removing resources your app won’t use, it’s not safe to assume that the LIBRARIES you’re including will do the same.Thankfully some helpful Gradle tools can put your A">
<meta property="og:image" content="http://lilei.work/img/170214_app_s4ep8/gradle.png">
<meta property="og:image" content="http://lilei.work/img/170214_app_s4ep8/limitations.png">
<meta property="og:updated_time" content="2017-02-14T01:49:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Performance Patterns - s4ep8 Removing Unused Resources">
<meta name="twitter:description" content="Although YOU may be diligent in removing resources your app won’t use, it’s not safe to assume that the LIBRARIES you’re including will do the same.Thankfully some helpful Gradle tools can put your A">
<meta name="twitter:image" content="http://lilei.work/img/170214_app_s4ep8/gradle.png">
  
    <link rel="alternative" href="/atom.xml" title="One Step, One Punch" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">One Step, One Punch</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">bequietlee#gmail.com</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lilei.work"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Android-Performance-Patterns-s4ep8-Removing-Unused-Resources" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/14/Android-Performance-Patterns-s4ep8-Removing-Unused-Resources/" class="article-date">
  <time datetime="2017-02-14T01:40:48.000Z" itemprop="datePublished">2017-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android Performance Patterns - s4ep8 Removing Unused Resources
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Although YOU may be diligent in removing resources your app won’t use, it’s not safe to assume that the LIBRARIES you’re including will do the same.<br>Thankfully some helpful Gradle tools can put your APK on a diet.<br><a href="https://www.youtube.com/watch?v=HxeW6DHEDQU&amp;index=18&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE" target="_blank" rel="external">link</a></p>
</blockquote>
<a id="more"></a>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HxeW6DHEDQU?list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE" frameborder="0" allowfullscreen></iframe>

<h1 id="问题起因"><a href="#问题起因" class="headerlink" title="问题起因"></a>问题起因</h1><p>无用的<code>Resources</code>存在于两部分，第一部分是项目文件中，开发者可以检查并直接移除这些文件；第二部分存在于依赖的<code>library</code>中。在一些情况下，我们只需要使用库里面的某一些功能，而并非全部功能。如果不加以特殊处理，其它未经使用资源文件也会被打入最终的APK中。</p>
<h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><p><code>Gradle</code>可以分析资源文件的使用情况，从而删除那些不需引入的资源文件。</p>
<p><img src="/img/170214_app_s4ep8/gradle.png" alt=""></p>
<p>如果要开启这项功能，需要在<code>gradle</code>配置文件中将<code>minifyEnabled</code>和<code>shrinkResources</code>声明为<code>true</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	buildTypes &#123;</span><br><span class="line">		release &#123;</span><br><span class="line">			minifyEnabled trure</span><br><span class="line">			shrinkResources true</span><br><span class="line">			proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们也可以强制保留／删除某些文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources xmlns:tools:=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">	tools:keep=&quot;@layout/l_used*_c, @layout/l_used_b*&quot;</span><br><span class="line">	tools:discard=&quot;@layout/unused2&quot;</span><br><span class="line">	/&gt;</span><br></pre></td></tr></table></figure>
<p>Gradle并非是万能的，它不会处理多分辨率／多语言下的资源文件（笔者对这部分存疑，这些资源文件原本就不需要精简，除非APP指定了仅供某些特定用户人群使用）</p>
<p><img src="/img/170214_app_s4ep8/limitations.png" alt=""></p>
<hr>
<h4 id="Ending"><a href="#Ending" class="headerlink" title="====Ending===="></a><em>====Ending====</em></h4><hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lilei.work/2017/02/14/Android-Performance-Patterns-s4ep8-Removing-Unused-Resources/" data-id="cizgbafa800080esul3mv7n3f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-Performance-Patterns/">Android Performance Patterns</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/15/Android-Touch-Event-Delivery/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android基础知识之事件传递
        
      </div>
    </a>
  
  
    <a href="/2017/02/13/Android-Performance-Patterns-s6ep6-VectorDrawable/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android Performance Patterns s6ep6 - VectorDrawable For Smaller APKs</div>
    </a>
  
</nav>

  
</article>


 <section id="comments">
   <!-- 多说评论框 start -->
   <div class="ds-thread" data-thread-key="post-Android-Performance-Patterns-s4ep8-Removing-Unused-Resources" data-title="Android Performance Patterns - s4ep8 Removing Unused Resources" data-url="http://lilei.work/2017/02/14/Android-Performance-Patterns-s4ep8-Removing-Unused-Resources/"></div>
   <!-- 多说评论框 end -->
   <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
   <script type="text/javascript">
   var duoshuoQuery = {short_name:'lileiwork'};
     (function() {
       var ds = document.createElement('script');
       ds.type = 'text/javascript';ds.async = true;
       ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
       ds.charset = 'UTF-8';
       (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
     })();
     </script>
   <!-- 多说公共JS代码 end -->
 </section>
 </section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Performance-Patterns/">Android Performance Patterns</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio/">Android Studio</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backend/">Backend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大保健/">大保健</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作效率/">工作效率</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微信小程序/">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术流/">技术流</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/槑/">槑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码分析/">源码分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化测试/">自动化测试</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
    <div class="widget-wrap">
	<h3 class="widget-title">Links</h3>
	<div class="widget">
		<ul class="entry">
		<li><a href="http://www.dcharm.com" title="dcharm">DCharm.com</a></li>
		<li><a href="http://www.lightskystreet.com" title="lightSky">lightSky</a></li>
		</ul>
	</div>
</div>
  
    <div class="widget-wrap">
	<h3 class="widget-title">Recent Comments</h3>
	<div class="widget">
		<ul class="ds-recent-comments" data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></ul>
	</div>
</div>

<!--多说js加载开始，一个页面只需要加载一次 -->
<script type="text/javascript">
if(typeof duoshuoQuery === 'undefined') {
	  var duoshuoQuery = {short_name:"lileiwork"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = 'http://static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
  }
</script>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Li Lei<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>